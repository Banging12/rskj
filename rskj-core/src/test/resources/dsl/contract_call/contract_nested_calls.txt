
comment

// Contracts compiled using
// Truffle v5.1.14 (core: 5.1.14)
// Solidity v0.5.16 (solc-js)
// the contract to be deployed is RevertReason

// the contracts source code

// SPDX-License-Identifier: GPL-3.0

// Warning: Return value of low-level calls not used.

pragma solidity >=0.5.0 <0.7.0;

contract RevertReason {
    uint public a = 11;

    function buy(uint amount) public payable returns (uint result) {
        require(
            amount > 0,
            "Negative value."
        );
        a = amount;
        return a;
    }
}

contract ContractB  {

    address rr;
    uint public a = 11;

    constructor(address _t) public {
        rr = _t;
    }

    function buy(uint amount) public returns (uint result) {
        rr.call(abi.encode("buy(uint256)", amount));
        a = amount;
        return amount;
    }

}

contract ContractA  {

    address cb;
    uint public a = 11;

    constructor(address _t) public {
        cb = _t;
    }

    function buy(uint amount) public returns (uint result) {
        cb.call(abi.encode("buy(uint256)", amount));
        a = amount;
        return amount;
    }

}

end

account_new acc1 20000000

# Deploy RevertReason

transaction_build tx01
    sender acc1
    nonce 0
    receiverAddress 00
    value 0
    data 6080604052600b60015534801561001557600080fd5b506040516102af3803806102af8339818101604052602081101561003857600080fd5b8101908080519060200190929190505050806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050610216806100996000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80630dbe671f1461003b578063d96a094a14610059575b600080fd5b61004361009b565b6040518082815260200191505060405180910390f35b6100856004803603602081101561006f57600080fd5b81019080803590602001909291905050506100a1565b6040518082815260200191505060405180910390f35b60015481565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168260405160200180806020018381526020018281038252600c8152602001807f6275792875696e74323536290000000000000000000000000000000000000000815250602001925050506040516020818303038152906040526040518082805190602001908083835b602083106101675780518252602082019150602081019050602083039250610144565b6001836020036101000a0380198251168184511680821785525050505050509050019150506000604051808303816000865af19150503d80600081146101c9576040519150601f19603f3d011682016040523d82523d6000602084013e6101ce565b606091505b5050508160018190555081905091905056fea2646970667358221220f0bbc831c9dd654180593843b768bd7cf9ec7364f03f3e5adc420362ce53aa2864736f6c63430006010033
    gas 2000000
    build

# Deploy ContractB

transaction_build tx02
    sender acc1
    nonce 1
    receiverAddress 00
    value 0
    data 6080604052600b60015534801561001557600080fd5b506040516102af3803806102af8339818101604052602081101561003857600080fd5b8101908080519060200190929190505050806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050610216806100996000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80630dbe671f1461003b578063d96a094a14610059575b600080fd5b61004361009b565b6040518082815260200191505060405180910390f35b6100856004803603602081101561006f57600080fd5b81019080803590602001909291905050506100a1565b6040518082815260200191505060405180910390f35b60015481565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168260405160200180806020018381526020018281038252600c8152602001807f6275792875696e74323536290000000000000000000000000000000000000000815250602001925050506040516020818303038152906040526040518082805190602001908083835b602083106101675780518252602082019150602081019050602083039250610144565b6001836020036101000a0380198251168184511680821785525050505050509050019150506000604051808303816000865af19150503d80600081146101c9576040519150601f19603f3d011682016040523d82523d6000602084013e6101ce565b606091505b5050508160018190555081905091905056fea2646970667358221220f0bbc831c9dd654180593843b768bd7cf9ec7364f03f3e5adc420362ce53aa2864736f6c634300060100330000000000000000000000006252703f5ba322ec64d3ac45e56241b7d9e481ad
    gas 2000000
    build

# Deploy ContractA

transaction_build tx03
    sender acc1
    nonce 2
    receiverAddress 00
    value 0
    data 6080604052600b60015534801561001557600080fd5b506040516102af3803806102af8339818101604052602081101561003857600080fd5b8101908080519060200190929190505050806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050610216806100996000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80630dbe671f1461003b578063d96a094a14610059575b600080fd5b61004361009b565b6040518082815260200191505060405180910390f35b6100856004803603602081101561006f57600080fd5b81019080803590602001909291905050506100a1565b6040518082815260200191505060405180910390f35b60015481565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168260405160200180806020018381526020018281038252600c8152602001807f6275792875696e74323536290000000000000000000000000000000000000000815250602001925050506040516020818303038152906040526040518082805190602001908083835b602083106101675780518252602082019150602081019050602083039250610144565b6001836020036101000a0380198251168184511680821785525050505050509050019150506000604051808303816000865af19150503d80600081146101c9576040519150601f19603f3d011682016040523d82523d6000602084013e6101ce565b606091505b5050508160018190555081905091905056fea264697066735822122022936f9bf06701079274955258bfcd1ee780e56b70e221d56d77a45049886cc464736f6c6343000601003300000000000000000000000056aa252dd82173789984fa164ee26ce2da9336ff
    gas 2000000
    build

block_build b01
    parent g00
    transactions tx01 tx02 tx03
    build

block_connect b01

# Assert best block
assert_best b01

# invoke increment(350) method

transaction_build tx04
    sender acc1
    nonce 3
    contract tx01   # created in tx01
    value 0
    data d96a094a0000000000000000000000000000000000000000000000000000000000000000
    gas 6400000
    build

block_build b02
    parent b01
    transactions tx04
    gasLimit 6500000
    build

block_connect b02

# Assert best block
assert_best b02

# Back to code test, you must check tx02 result is Error with message = "Negative value."

