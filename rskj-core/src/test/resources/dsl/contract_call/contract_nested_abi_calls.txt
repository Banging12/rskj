
comment

// Contracts compiled using
// Truffle v5.1.14 (core: 5.1.14)
// Solidity v0.5.16 (solc-js)
// the contract to be deployed is RevertReason

// the contracts source code

pragma solidity >=0.5.0 <0.7.0;

contract RevertReason {
    uint public a = 1;

    function buy(uint amount) public payable {
        require(
            amount > 0,
            "Negative value."
        );
        a = amount;
        return a;
    }
}

pragma solidity >=0.5.0 <0.7.0;

contract ContractB  {

    RevertReason rr;

    function ContractB(address _t) public {
        rr = RevertReason(_t);
    }

    function buy(uint amount) public returns (uint result) {
        rr.buy(amount);
        assembly {
            call()

        }
        return amount;
    }

}

pragma solidity >=0.5.0 <0.7.0;

contract ContractA  {

    ContractB cb;

    function ContractA(address _t) public {
        cb = ContractB(_t);
    }

    function buy(uint amount) public returns (uint result) {
        cb.buy(amount);
        return amount;
    }

}

end

account_new acc1 20000000

# Deploy RevertReason

transaction_build tx01
    sender acc1
    nonce 0
    receiverAddress 00
    value 0
    data 6080604052600160005534801561001557600080fd5b5061015f806100256000396000f3fe6080604052600436106100295760003560e01c80630dbe671f1461002e578063d96a094a14610059575b600080fd5b34801561003a57600080fd5b5061004361009b565b6040518082815260200191505060405180910390f35b6100856004803603602081101561006f57600080fd5b81019080803590602001909291905050506100a1565b6040518082815260200191505060405180910390f35b60005481565b6000808211610118576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600f8152602001807f4e656761746976652076616c75652e000000000000000000000000000000000081525060200191505060405180910390fd5b81600081905550600054905091905056fea26469706673582212201f193ef58854091851e7920e80951c06ad7b9f9d46f47de3ca497ce6610b9bfb64736f6c634300060c0033
    gas 2000000
    build

# Deploy ContractB

transaction_build tx02
    sender acc1
    nonce 1
    receiverAddress 00
    value 0
    data 608060405234801561001057600080fd5b506040516101f63803806101f68339818101604052602081101561003357600080fd5b8101908080519060200190929190505050806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050610162806100946000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063d96a094a14610030575b600080fd5b61005c6004803603602081101561004657600080fd5b8101908080359060200190929190505050610072565b6040518082815260200191505060405180910390f35b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d96a094a836040518263ffffffff1660e01b815260040180828152602001915050602060405180830381600087803b1580156100e857600080fd5b505af11580156100fc573d6000803e3d6000fd5b505050506040513d602081101561011257600080fd5b81019080805190602001909291905050505081905091905056fea2646970667358221220e714a0a44af2441349dd95d8ebb7b68850cead4c84f98e68e570710235d6a84864736f6c634300060c00330000000000000000000000006252703f5ba322ec64d3ac45e56241b7d9e481ad
    gas 2000000
    build

# Deploy ContractA

transaction_build tx03
    sender acc1
    nonce 2
    receiverAddress 00
    value 0
    data 608060405234801561001057600080fd5b506040516101f63803806101f68339818101604052602081101561003357600080fd5b8101908080519060200190929190505050806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050610162806100946000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063d96a094a14610030575b600080fd5b61005c6004803603602081101561004657600080fd5b8101908080359060200190929190505050610072565b6040518082815260200191505060405180910390f35b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663d96a094a836040518263ffffffff1660e01b815260040180828152602001915050602060405180830381600087803b1580156100e857600080fd5b505af11580156100fc573d6000803e3d6000fd5b505050506040513d602081101561011257600080fd5b81019080805190602001909291905050505081905091905056fea264697066735822122025f86e5ba6a4fedcbe56b85041821dceb0748467e8215c57c114b12f669dc6ad64736f6c634300060c003300000000000000000000000056aa252dd82173789984fa164ee26ce2da9336ff
    gas 2000000
    build

block_build b01
    parent g00
    transactions tx01 tx02 tx03
    build

block_connect b01

# Assert best block
assert_best b01

# invoke increment(350) method

transaction_build tx04
    sender acc1
    nonce 3
    contract tx01   # created in tx01
    value 0
    data d96a094a0000000000000000000000000000000000000000000000000000000000000000
    gas 6400000
    build

block_build b02
    parent b01
    transactions tx04
    gasLimit 6500000
    build

block_connect b02

# Assert best block
assert_best b02

# Back to code test, you must check tx02 result is Error with message = "Negative value."

